{
	"info": {
		"_postman_id": "d5e83c02-3b7f-43cf-90e7-4d4b1bb3d992",
		"name": "OPA POC",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "40343872"
	},
	"item": [
		{
			"name": "Allow/Deny Requests",
			"item": [
				{
					"name": "Happy Path / Default",
					"item": [
						{
							"name": "Allowed",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"nomination_create\",\r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"EXN\", \"CHV\", \"EXN\"],\r\n        \"companyParties\": [\"shipper\", \"supCon\", \"tankage\"],\r\n        \"subscribers\": [\"CPL\"]\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Actions",
					"item": [
						{
							"name": "Denied - Action Not Inherited",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"alice\",\r\n    \"action\": \"nomination_view\", // Alice is an inspector, who by default only gets 'nomination_view' and 'ticket_view', but her subscriber (KMO) only has ticket permissions, thus only 'ticket_view' works for Alice. \r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"P66\", \"P66\", \"EXN\"],\r\n        \"companyParties\": [\"shipper\", \"supCon\", \"tankage\"],\r\n        \"subscribers\": [\"KMO\"]\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						},
						{
							"name": "Denied - Action Not Assigned To Any Roles Or Subscribers",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"admin_add_application\", // This action is not granted to any subscribers\r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"EXN\", \"CHV\", \"EXN\"],\r\n        \"companyParties\": [\"shipper\", \"supCon\", \"tankage\"],\r\n        \"subscribers\": [\"CPL\"]\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "PSS Rights",
					"item": [
						{
							"name": "Denied - Missing PSS Right For Action",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"nomination_subscriber_confirm\", // This action requires the pss right 'pss_nomination_subscriber_confirm' which 'bob' does not have\r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"EXN\", \"EXN\", \"CHV\", \"EXN\"],\r\n        \"companyParties\": [\"carrier\", \"shipper\", \"supCon\", \"tankage\"],\r\n        \"subscribers\": [\"CPL\"]\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Company Party",
					"item": [
						{
							"name": "Denied - Shipper Party Required By Action Not Inherited By Principal",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"nomination_edit\",\r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"EXN\", \"CHV\", \"EXN\"],\r\n        \"companyParties\": [\"supCon\", \"shipper\", \"tankage\"], // this action 'nomination_edit' requires 'shipper' party to be inherited but 'bob' does NOT have permissions for 'CHV'\r\n        \"subscribers\": [\"CPL\"]\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						},
						{
							"name": "Denied - Tankage Party Required By Action Not Inherited By Principal",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"nomination_tankage_confirm\",\r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"EXN\", \"EXN\", \"PHI\"],\r\n        \"companyParties\": [\"supCon\", \"shipper\", \"tankage\"], // this action 'nomination_tankage_confirm' requires 'tankage' party to be inherited but 'bob' does NOT have permissions for 'PHI'\r\n        \"subscribers\": [\"CPL\"]\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						},
						{
							"name": "Denied - Action Does Not Require A Company Party But No Companies Are Inherited",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"nomination_view\", // this action 'nomination_view' does NOT require a specific party to be inherited, but no companies requested below are inheritied.\r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"PHI\", \"CHV\", \"MOB\"], // 'bob' only inherits from 'EXN' so without 'EXN' in this list, he will be denied\r\n        \"companyParties\": [\"supCon\", \"shipper\", \"tankage\"],\r\n        \"subscribers\": [\"CPL\"]\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						},
						{
							"name": "Allowed - Action Does Not Require A Company Party But TPT Company Is Inherited",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"nomination_view\", // this action 'nomination_view' does NOT require a specific party to be inherited\r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"PHI\", \"CHV\", \"MOB\", \"KMO\", \"EXN\"], // 'bob' only inherits from 'EXN' so as long as 'EXN' is somewhere in this list, it will be allowed.\r\n        \"companyParties\": [\"supCon\", \"shipper\", \"tankage\", \"tpt\", \"tpt\"],\r\n        \"subscribers\": [\"CPL\"]\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Company",
					"item": [
						{
							"name": "Denied - No Principal Permissions For Company",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"nomination_view\",\r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"KMO\", \"CHV\", \"PHI\"], // This principal has no permissions associated with these companis, but does for 'EXN'\r\n        \"companyParties\": [\"shipper\", \"supCon\", \"tankage\"],\r\n        \"subscribers\": [\"CPL\"]\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						},
						{
							"name": "Allowed - Principal Permissions For Some But Not All Companies",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"nomination_create\",\r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"EXN\", \"CHV\", \"P66\"], // This principal has permissions associated with only one of these companies, but only one is needed (possibly for specific party)\r\n        \"companyParties\": [\"shipper\", \"supCon\", \"tankage\"],\r\n        \"subscribers\": [\"CPL\"]\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Subscriber",
					"item": [
						{
							"name": "Denied - No Principal Permissions For Subscriber",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"nomination_create\",\r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"EXN\", \"CHV\", \"EXN\"],\r\n        \"companyParties\": [\"shipper\", \"supCon\", \"tankage\"],\r\n        \"subscribers\": [\"MOB\"] // This principal has no permissions associated with this subscriber, but does with 'CPL'\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Product Type",
					"item": [
						{
							"name": "Denied - Product Type Not Inherited From Companies",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"nomination_create\",\r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"KER\"], // This product type is not one of any inherited companies product types, but 'GAS' or 'JET' are.\r\n        \"companies\": [\"EXN\", \"CHV\", \"EXN\"],\r\n        \"companyParties\": [\"shipper\", \"supCon\", \"tankage\"],\r\n        \"subscribers\": [\"CPL\"]\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						},
						{
							"name": "Denied - One But Not All Product Types Inherited From Companies",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"nomination_edit\",\r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"], \r\n        \"productTypes\": [\"GAS\", \"KER\"], // One product type (GAS) is inherited from a company, the other (KER) is unknown\r\n        \"companies\": [\"EXN\", \"CHV\", \"EXN\"],\r\n        \"companyParties\": [\"shipper\", \"supCon\", \"tankage\"],\r\n        \"subscribers\": [\"CPL\"]\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Location",
					"item": [
						{
							"name": "Denied - Location Not Inherited From Companies",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"nomination_edit\",\r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"ATL\"], // This location is not one of any inherited companies locations, but 'DVD' is.\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"EXN\", \"CHV\", \"EXN\"],\r\n        \"companyParties\": [\"shipper\", \"supCon\", \"tankage\"],\r\n        \"subscribers\": [\"CPL\"]\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						},
						{
							"name": "Denied - Some But Not All Locations Inherited From Companies",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"nomination_edit\",\r\n    \"requestType\": \"evaluate\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\", \"ATL\"], // One location (DVD) is inherited from a subscriber, the other (ATL) is unknown\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"EXN\", \"CHV\", \"EXN\"],\r\n        \"companyParties\": [\"shipper\", \"supCon\", \"tankage\"],\r\n        \"subscribers\": [\"CPL\"]\r\n    }\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "127.0.0.1:5000/api/nominations",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"port": "5000",
									"path": [
										"api",
										"nominations"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "SQL Generation Requests",
			"item": [
				{
					"name": "Allowed - Nomination Search (Bob)",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"principal\": \"bob\",\r\n    \"action\": \"nomination_view\",\r\n    \"requestType\": \"generate_query\",\r\n    \"unknown\": \"nominations\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"EXN\", \"CHV\", \"EXN\"],\r\n        \"companyParties\": [\"shipper\", \"supCon\", \"tankage\"],\r\n        \"subscribers\": [\"CPL\"]\r\n    }\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "127.0.0.1:5000/api/nominations/search",
							"host": [
								"127",
								"0",
								"0",
								"1"
							],
							"port": "5000",
							"path": [
								"api",
								"nominations",
								"search"
							]
						}
					},
					"response": []
				},
				{
					"name": "Allowed - Ticket Search (Alice)",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"principal\": \"alice\",\r\n    \"action\": \"ticket_view\",\r\n    \"requestType\": \"generate_query\",\r\n    \"unknown\": \"tickets\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"P66\", \"EXN\", \"CHV\"],\r\n        \"companyParties\": [\"shipper\", \"subCon\", \"tankage\"],\r\n        \"subscribers\": [\"KMO\"]\r\n    }\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "127.0.0.1:5000/api/nominations/search",
							"host": [
								"127",
								"0",
								"0",
								"1"
							],
							"port": "5000",
							"path": [
								"api",
								"nominations",
								"search"
							]
						}
					},
					"response": []
				},
				{
					"name": "Denied - Nomination Search (Alice)",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"principal\": \"alice\",\r\n    \"action\": \"nomination_view\", // Alice does not inherit this action, so no query is generated\r\n    \"requestType\": \"generate_query\",\r\n    \"unknown\": \"nominations\",\r\n    \"context\": {\r\n        \"locations\": [\"DVD\"],\r\n        \"productTypes\": [\"GAS\"],\r\n        \"companies\": [\"P66\", \"EXN\", \"CHV\"],\r\n        \"companyParties\": [\"shipper\", \"subCon\", \"tankage\"],\r\n        \"subscribers\": [\"KMO\"]\r\n    }\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "127.0.0.1:5000/api/nominations/search",
							"host": [
								"127",
								"0",
								"0",
								"1"
							],
							"port": "5000",
							"path": [
								"api",
								"nominations",
								"search"
							]
						}
					},
					"response": []
				}
			]
		}
	]
}